for(queue=[],enabled=!0,open=!0,group=[],size=10,i=0;i<ledger.length;i++)if(args=ledger[i].split(","),0!=args.length)switch(args[0]){case"e":enabled=!0;break;case"d":enabled=!1;break;case"o":open=!0;break;case"c":open=!1;break;case"s":if(2!=args.length)continue;if(n=parseInt(args[1]),isNaN(n)||0>=n)continue;size=n;break;case"g":if(group.length+queue.length<size)continue;newPlayers=queue.length>size?size:queue.length,reusedPlayers=size-newPlayers,group=queue.splice(0,newPlayers).concat(group.splice(0,reusedPlayers));break;case"r":if(2!=args.length)continue;for(u=args[1].toLowerCase(),j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){queue.splice(j,1);break}for(j=0;j<group.length;j++)if(u==group[j].toLowerCase()){0==queue.length?group.splice(j,1):group.splice(j,1,queue.splice(0,1)[0]);break}break;case"j":if(2!=args.length)continue;queue.push(args[1]);break;case"m":if(3!=args.length)continue;if(u=args[1].toLowerCase(),p=parseInt(args[2]),isNaN(p)||0>p||p>=queue.length)continue;for(j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){queue.splice(p,0,queue.splice(j,1)[0]);break}}if(streamerUserLevels=["owner"],trustedUserLevels=["owner","moderator","regular"],enabled||streamerUserLevels.includes(userLevel)){function a(b){for(string="",k=0;k<b.length;k++)string+=b[k],2<b.length&&k!=b.length-1&&(string+=", "),k==b.length-2&&(string+=" and ");return string}if(args=query.split(" "),query&&1<=args.length)switch(addUrl=`http://twitch.center/customapi/addquote?token=${privateToken}&data=`,clearUrl=`http://twitch.center/customapi/delquote?token=${privateToken}&clear=1`,args[0].toLowerCase()){case"on":case"enable":streamerUserLevels.includes(userLevel)?enabled?`$PRINT$ ${userName} -> Queue functions are already enabled`:addUrl+encodeURIComponent("e|")+"&print="+encodeURIComponent("Queue functions are now enabled!"):`$PRINT$ ${userName} -> You must be the streamer to enable the queue`;break;case"off":case"disable":streamerUserLevels.includes(userLevel)?enabled?addUrl+encodeURIComponent("d|")+"&print="+encodeURIComponent("Queue functions are now disabled!"):`$PRINT$ ${userName} -> Queue functions are already disabled`:`$PRINT$ ${userName} -> You must be the streamer to disable the queue`;break;case"start":case"begin":case"open":trustedUserLevels.includes(userLevel)?open?`$PRINT$ ${userName} -> The queue is already open`:addUrl+encodeURIComponent("o|")+"&print="+encodeURIComponent("The queue is now open!"):`$PRINT$ ${userName} -> You must be a trusted user to start the queue`;break;case"stop":case"end":case"close":trustedUserLevels.includes(userLevel)?open?addUrl+encodeURIComponent("c|")+"&print="+encodeURIComponent("The queue is now closed!"):`$PRINT$ ${userName} -> The queue is already closed`:`$PRINT$ ${userName} -> You must be a trusted user to end the queue`;break;case"view":case"show":case"list":case"all":trustedUserLevels.includes(userLevel)?`$PRINT$ Current group: ${a(group)} | Queue: ${a(queue)}`.substr(0,400):`$PRINT$ ${userName} -> You must be a trusted user to view the entire queue`;break;case"setsize":case"changesize":trustedUserLevels.includes(userLevel)?2==args.length?(newSize=parseInt(args[1]),isNaN(newSize)||0>=newSize?`$PRINT$ ${userName} -> Enter a positive integer after "!queue ${args[0]}"`:size==newSize?`$PRINT$ ${userName} -> The player group size is already ${size}`:addUrl+encodeURIComponent(`s,${newSize}|`)+"&print="+encodeURIComponent(`The player group size was changed from ${size} to ${newSize}!`)):`$PRINT$ ${userName} -> Enter a new player group size after "!queue ${args[0]}"`:`$PRINT$ ${userName} -> You must be a trusted user to set the player group size`;break;case"new":case"newgroup":case"generate":case"generategroup":case"next":case"nextgroup":trustedUserLevels.includes(userLevel)?(availablePlayers=group.length+queue.length,availablePlayers<size?`$PRINT$ ${userName} -> The number of players in the queue and current group (${availablePlayers}) isn't high enough to generate a new group of size ${size}`:(newPlayers=queue.length>size?size:queue.length,reusedPlayers=size-newPlayers,group=queue.splice(0,newPlayers).concat(group.splice(0,reusedPlayers)),(addUrl+encodeURIComponent("g|")+"&print="+encodeURIComponent(`New group: ${a(group)}`)).substr(0,400))):`$PRINT$ ${userName} -> You must be a trusted user to generate a new group from the queue`;break;case"clear":case"reset":trustedUserLevels.includes(userLevel)?"There are no quotes added"==ledger?`$PRINT$ ${userName} -> The queue and current group are already empty`:clearUrl+"&print="+encodeURIComponent("The queue and current group are now empty!"):`$PRINT$ ${userName} -> You must be a trusted user to clear the queue and current group`;break;case"add":case"addviewer":case"adduser":case"addfollower":if(!trustedUserLevels.includes(userLevel))`$PRINT$ ${userName} -> You must be a trusted user to add a viewer to the queue`;else if(2<=args.length){for(user=query.substr(query.indexOf(" ")+1).replace(/[|,]/g,""),u=user.toLowerCase(),currentQueuePosition=-1,j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){currentQueuePosition=j;break}for(foundInGroup=!1,j=0;j<group.length;j++)if(u==group[j].toLowerCase()){foundInGroup=!0;break}-1==currentQueuePosition?foundInGroup?`$PRINT$ ${userName} -> ${user} is already in the current group`:addUrl+encodeURIComponent(`j,${user}|`)+"&print="+encodeURIComponent(`${user} was added to the queue at position ${queue.length+1}`):`$PRINT$ ${userName} -> ${user} is already in the queue at position ${currentQueuePosition+1}`}else`$PRINT$ ${userName} -> Enter the viewer to add after "!queue ${args[0]}"`;break;case"remove":case"removeviewer":case"removeuser":case"removefollower":case"delete":case"deleteviewer":case"deleteuser":case"deletefollower":case"del":case"delviewer":case"deluser":case"delfollower":if(!trustedUserLevels.includes(userLevel))`$PRINT$ ${userName} -> You must be a trusted user to remove a viewer from the queue or current group`;else if(2<=args.length){for(user=query.substr(query.indexOf(" ")+1).replace(/[|,]/g,""),u=user.toLowerCase(),currentQueuePosition=-1,j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){currentQueuePosition=j;break}for(foundInGroup=!1,j=0;j<group.length;j++)if(u==group[j].toLowerCase()){foundInGroup=!0;break}-1==currentQueuePosition?foundInGroup?addUrl+encodeURIComponent(`r,${user}|`)+"&print="+encodeURIComponent(`${user} was removed from the current group`+(0==queue.length?"":` and was replaced by ${queue[0]}`)):`$PRINT$ ${userName} -> ${user} is not in the queue or current group`:addUrl+encodeURIComponent(`r,${user}|`)+"&print="+encodeURIComponent(`${user} was removed from the queue at position ${currentQueuePosition+1}`)}else`$PRINT$ ${userName} -> Enter the viewer to remove after "!queue ${args[0]}"`;break;case"move":case"moveviewer":case"moveuser":case"movefollower":if(!trustedUserLevels.includes(userLevel))`$PRINT$ ${userName} -> You must be a trusted user to move a viewer in the queue`;else if(0==queue.length)`$PRINT$ ${userName} -> The queue is empty`;else if(1==queue.length)`$PRINT$ ${userName} -> Because there is only 1 viewer in the queue, it cannot be rearranged`;else if(match=query.match(/^[^ ]+ +([^ ].*?) +([^ ]+)$/),!match)`$PRINT$ ${userName} -> Enter the viewer to move and the new position after "!queue ${args[0]}"`;else if(user=match[1].replace(/[|,]/g,""),u=user.toLowerCase(),position=parseInt(match[2]),isNaN(position)||1>position||position>queue.length)`$PRINT$ ${userName} -> The position must be between 1 and ${queue.length}`;else{for(position-=1,currentPosition=-1,j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){currentPosition=j;break}-1==currentPosition?`$PRINT$ ${userName} -> ${user} is not in the queue`:position==currentPosition?`$PRINT$ ${userName} -> ${user} is already in the queue at position ${currentPosition+1}`:addUrl+encodeURIComponent(`m,${user},${position}|`)+"&print="+encodeURIComponent(`${user} was moved from position ${currentPosition+1} to ${position+1}`)}break;case"join":if(open||trustedUserLevels.includes(userLevel)){for(user=userName.replace(/[|,]/g,""),u=user.toLowerCase(),currentQueuePosition=-1,j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){currentQueuePosition=j;break}for(foundInGroup=!1,j=0;j<group.length;j++)if(u==group[j].toLowerCase()){foundInGroup=!0;break}-1==currentQueuePosition?foundInGroup?`$PRINT$ ${userName} -> You are already in the current group`:addUrl+encodeURIComponent(`j,${user}|`)+"&print="+encodeURIComponent(`${userName} joined the queue at position ${queue.length+1}`):`$PRINT$ ${userName} -> You are already in the queue at position ${currentQueuePosition+1}`}else`$PRINT$ ${userName} -> The queue is closed`;break;case"leave":if(open||trustedUserLevels.includes(userLevel)){for(user=userName.replace(/[|,]/g,""),u=user.toLowerCase(),currentQueuePosition=-1,j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){currentQueuePosition=j;break}for(foundInGroup=!1,j=0;j<group.length;j++)if(u==group[j].toLowerCase()){foundInGroup=!0;break}-1==currentQueuePosition?foundInGroup?addUrl+encodeURIComponent(`r,${user}|`)+"&print="+encodeURIComponent(`${userName} left the current group`+(0==queue.length?"":` and was replaced by ${queue[0]}`)):`$PRINT$ ${userName} -> You are not in the queue or current group`:addUrl+encodeURIComponent(`r,${user}|`)+"&print="+encodeURIComponent(`${userName} left the queue at position ${currentQueuePosition+1}`)}else`$PRINT$ ${userName} -> The queue is closed`;break;case"players":case"currentgroup":case"group":`$PRINT$ Current group: ${a(group)}`.substr(0,400);break;case"size":case"length":`$PRINT$ Queue length: ${queue.length}`;break;case"groupsize":case"currentgroupsize":`$PRINT$ Current group size: ${group.length}/${size}`;break;case"position":case"myposition":for(u=userName.toLowerCase(),positionInQueue=-1,j=0;j<queue.length;j++)if(u==queue[j].toLowerCase()){positionInQueue=j;break}if(-1!=positionInQueue)`$PRINT$ ${userName}'s queue position is ${positionInQueue+1}`;else{for(foundInGroup=!1,j=0;j<group.length;j++)if(u==group[j].toLowerCase()){foundInGroup=!0;break}foundInGroup?`$PRINT$ ${userName} -> You are in the current group`:`$PRINT$ ${userName} -> You are not in the queue or current group`}break;default:`$PRINT$ ${userName} -> That is not a valid subcommand`;}else`$PRINT$ Current group: ${a(group)} | !queue subcommands: join, leave, players, size, groupsize, and position`.substr(0,400)}else`$PRINT$ ${userName} -> Queue functions are disabled`;
